<!DOCTYPE html>
  <head>
    <title>Mesosphere - Exercise 20: Advanced Cluster Building</title>
    <meta name="title" content ="Mesosphere Documentation Intro Course">
    
      <meta name="description" content="Mesos allows you to create a highly-available and scalable cluster on your existing hardware.">
    
    <meta name="keywords" content="mesos, mesosphere, apache mesos, cluster, mesos cluster, apache mesos, mesos tutorial, ETL, long-running services, service automation, distributed kernel, apache marathon, marathon tutorial, chronos tutorial, spark tutorial">
    <meta name="googlebot" content="all" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css"
      rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css"
      rel="stylesheet">
    <link rel="stylesheet" href="/assets/mesosphere-bb1dd6431996c0a6e479673c87a06efc.css">
    <link rel="alternate" type="application/atom+xml" title="The Mesosphere Blog" href="/blog/atom.xml">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/apple-touch-icon-114x114-precomposed-866a1e471ec7ca6bd71446ca972285c6.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/apple-touch-icon-72x72-precomposed-4a308d281d978c5a39fd1893ca051959.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/apple-touch-icon-57x57-precomposed-d7a5a878dcc95e57717cc774eeac8c22.png">
    
    <link rel="stylesheet" href="style.css">
    <script src="//cdn.optimizely.com/js/2009520669.js"></script>
    <script>
      window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
      window.analytics.load("7sgtwqvuai");
      window.analytics.page();
    </script>
    
  </head>
<body>

<div class="navbar navbar-default  " role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>


            <a class="navbar-brand" href="http://mesosphere.com/">


                <img src="http://dw8zztroqvu2r.cloudfront.net/assets/mesosphere-165b872607f4d76434d9b1cfb41a6280.png" width="148" height="25" alt="Mesosphere">


            </a>
        </div>
        <div class="collapse navbar-collapse">
        </div>
    </div>
</div>

<div class="body-light">
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <div role="complementary">
                    <gcse:searchbox-only></gcse:searchbox-only>
                    <ul class="nav docs-sidenav">
                        <li><a class="reference external" href="intro.html">Introduction</a></li>
                        <li><a class="reference external" href="ex1.html">01: Installing Software</a></li>
                        <li><a class="reference external" href="ex2.html">02: Installing ZooKeeper</a></li>
                        <li><a class="reference external" href="ex3.html">03: Using Apache Mesos</a></li>
                        <li><a class="reference external" href="ex4.html">04: Starting Marathon</a></li>
                        <li><a class="reference external" href="ex5.html">05: Using the Marathon GUI</a></li>
                        <li><a class="reference external" href="ex6.html">06: Marathon REST API</a></li>
                        <li><a class="reference external" href="ex7.html">07: Building and Running Mesos DNS</a></li>
                        <li><a class="reference external" href="ex8.html">08: Installing Chronos</a></li>
                        <li><a class="reference external" href="ex9.html">09: Creating A Slave Node</a></li>
                        <li><a class="reference external" href="ex10.html">10: Installing Mesos</a></li>
                        <li><a class="reference external" href="ex11.html">11: Scaling To Two Nodes</a></li>
                        <li><a class="reference external" href="ex12.html">12: Deploying A Web App With Docker</a></li>
                        <li><a class="reference external" href="ex13.html">13: Distributing Docker To Multiple Nodes</a></li>
                        <li><a class="reference external" href="ex14.html">14: Installing and Using Mesos CLI</a></li>
                        <li><a class="reference external" href="ex15.html">15: Starting Four Nodes</a></li>
                        <li><a class="reference external" href="ex16.html">16: Recreating the Cluster Using Ansible</a></li>
                        <li><a class="reference external" href="ex17.html">17: Advanced Usage of the Marathon</a></li>
                        <li><a class="reference external" href="ex18.html">18: Advanced Usage of Chronos</a></li>
                        <li><a class="reference external" href="ex19.html">19: Troubleshooting</a></li>
                        <li><a class="reference external" href="ex20.html">20: Advanced Cluster Building</a></li>
                    </ul> 
                </div>

            </div>
            <div class="col-md-8">

                <!--- RST STARTS -->
                <h1 class="title">Exercise 20: Advanced Cluster Building</h1>
                <p>This final exercise teaches you how to use your Ansible configuration
to craft Virtualbox templates that you can use to build more nodes in the cluster.
This is to simulate how to combine Ansible with VM templates to get more
repeatable builds for your node.</p>
<p>In this exercise:</p>
<ol class="arabic simple">
<li>Use Ansible, Chef, or Puppet to craft nodes locally.</li>
<li>Save them to a template file once they work well and you need to deploy.</li>
<li>Use that template to then seed your cluster quicker and more reliably to get base node configuration.</li>
<li>Let Marathon get the rest of your infrastructure running using Docker applications.</li>
</ol>
<div class="section" id="video-lecture">
<h1>Video Lecture</h1>
<p>Video lecture pending for this exercise.</p>
</div>
<div class="section" id="quick-reference">
<h1>Quick Reference</h1>
<p>Run the new <tt class="docutils literal">nodes</tt> configuration for your slave nodes that disables a few more things and gets the ready for this first phase:</p>
<div class="highlight"><pre><a name="code--ex20--playbook.yml-jinja-idio.html-1"></a><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nodes</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-2"></a>  <span class="l-Scalar-Plain">remote_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">vagrant</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-3"></a>  <span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-4"></a>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-5"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">update the hosts file</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-6"></a>        <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">src=./hosts.j2 dest=/etc/hosts</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-7"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install the mesosphere yum repo</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-8"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rpm -Uvh http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-9"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install the mesos and docker packages</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-10"></a>        <span class="l-Scalar-Plain">yum</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pkg=device-mapper-event-libs,mesos,docker state=latest</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-11"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">configure containerizers</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-12"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">echo &#39;docker,mesos&#39; | sudo tee /etc/mesos-slave/containerizers</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-13"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">set the zookeeper master</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-14"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sed -i -e &#39;s/localhost/192.168.33.10/g&#39; /etc/mesos/zk</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-15"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">stop the mesos slave but make it start on book</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-16"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=mesos-slave state=stopped enabled=yes</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-17"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">disable the mesos-master by default</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-18"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=mesos-master state=stopped enabled=no</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-19"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">kill the slave state</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-20"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rm -rf /tmp/mesos*</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-21"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start docker</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-22"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=docker state=started enabled=yes</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-23"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install outyet</span>
<a name="code--ex20--playbook.yml-jinja-idio.html-24"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sudo docker load --input=/vagrant/outyet.tar.gz</span>
</pre></div><p>This is effectively adding cleaning out some <tt class="docutils literal"><span class="pre">mesos-slave</span></tt> state before the server starts, but later we'll do this again to <tt class="docutils literal">node2</tt> to get it ready for saving.</p>
<p>Run <tt class="docutils literal">vagrant destroy</tt>:</p>
<div class="highlight"><pre><a name="code--ex20--build.sh-session-jinja-idio.html-1"></a><span class="gp">$</span> vagrant destroy -f <span class="o">&amp;&amp;</span> vagrant up node1 node2
</pre></div><p>To confirm that your <tt class="docutils literal">playbook.yml</tt> works and can build the master and the first slave.  Once it comes up, node2 should not have <tt class="docutils literal"><span class="pre">mesos-slave</span></tt> running and there's nothing in <tt class="docutils literal">/tmp</tt> because you cleared the state in the <tt class="docutils literal">playbook.yml</tt>.  Next you halt <tt class="docutils literal">node2</tt> so you can package it:</p>
<div class="highlight"><pre><a name="code--ex20--build.sh-session-jinja-idio.html-1"></a><span class="gp">$</span> vagrant halt node2
</pre></div><p>Save the <tt class="docutils literal">node2</tt> Vagrant box to a new <tt class="docutils literal"><span class="pre">mesos-slave</span></tt> box:</p>
<div class="highlight"><pre><a name="code--ex20--build.sh-session-jinja-idio.html-1"></a><span class="gp">$</span> rm -f package.box
<a name="code--ex20--build.sh-session-jinja-idio.html-2"></a><span class="gp">$</span> vagrant package node2
<a name="code--ex20--build.sh-session-jinja-idio.html-3"></a><span class="gp">$</span> vagrant box add mesos-slave package.box
</pre></div><p>Destroy the <tt class="docutils literal">node3</tt> and <tt class="docutils literal">node4</tt> to get them ready to build based on the new configuration:</p>
<div class="highlight"><pre><a name="code--ex20--build.sh-session-jinja-idio.html-1"></a><span class="gp">$</span> vagrant destroy -f node3 node4
</pre></div><p>You have to do this before changing the <tt class="docutils literal">Vagrantfile</tt> or else Vagrant can't find them.</p>
<p>Change the configuration for <tt class="docutils literal">node3</tt> and <tt class="docutils literal">node4</tt> to:</p>
<div class="highlight"><pre><a name="code--ex20--Vagrantfile.rb-jinja-idio.html-1"></a>    <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&quot;node3&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">node3</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-2"></a>        <span class="n">node3</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.33.12&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-3"></a>        <span class="n">node3</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;node3&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-4"></a>        <span class="n">node3</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;mesos-slave&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-5"></a>        <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="s2">&quot;sudo cp /vagrant/hosts.j2 /etc/hosts&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-6"></a>    <span class="k">end</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-7"></a>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-8"></a>    <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&quot;node4&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">node4</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-9"></a>        <span class="n">node4</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.33.13&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-10"></a>        <span class="n">node4</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;node4&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-11"></a>        <span class="n">node4</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;mesos-slave&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-12"></a>        <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="s2">&quot;sudo cp /vagrant/hosts.j2 /etc/hosts&quot;</span>
<a name="code--ex20--Vagrantfile.rb-jinja-idio.html-13"></a>    <span class="k">end</span>
</pre></div><p>Run <tt class="docutils literal">vagrant up</tt> to build using the node template rather than with Ansible.  After that all the nodes should be ready, but in a default clean state.  Simply restart them and they'll fire up as new slave nodes:</p>
<div class="highlight"><pre><a name="code--ex20--build.sh-session-jinja-idio.html-1"></a><span class="gp">$</span> vagrant up node3 node4
<a name="code--ex20--build.sh-session-jinja-idio.html-2"></a><span class="gp">$</span> vagrant halt node2 node3 node4
<a name="code--ex20--build.sh-session-jinja-idio.html-3"></a><span class="gp">$</span> vagrant up
</pre></div><p>Once that works you should see the new slave nodes and also see your Marathon configuration start deploying the apps to them. If you <tt class="docutils literal">vagrant up</tt> and they still aren't recognized by Mesos as slaves then check the following:</p>
<ol class="arabic simple">
<li>Is <tt class="docutils literal">/etc/hosts</tt> configured correctly on all nodes?</li>
<li>Are <tt class="docutils literal"><span class="pre">mesos-slave</span></tt> processes running on all nodes?</li>
<li>Did you wait a little while?  Sometimes Mesos takes a little time to recognize new nodes, but not longer than 10 minutes.</li>
<li>Did you configure <tt class="docutils literal">docker,mesos</tt> in the <tt class="docutils literal"><span class="pre">/etc/mesos-slave/containerizers</span></tt> file?  The <tt class="docutils literal">playbook.yml</tt> should do this but go confirm that's configured.</li>
<li>If all else fails, shut down the nodes and start them again.</li>
<li>If that all fails then look at the <tt class="docutils literal">/etc/mesos/</tt> logs and see if there's any cluse, then contact us in the comments for help.</li>
</ol>
</div>
<div class="section" id="final-configuration">
<h1>Final Configuration</h1>
<p>Your final Ansible <tt class="docutils literal">playbook.yml</tt> is now this:</p>
<div class="highlight"><pre><a name="code--ex20--playbook_full.yml-jinja-idio.html-1"></a><span class="nn">---</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-2"></a><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">master</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-3"></a>  <span class="l-Scalar-Plain">remote_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">vagrant</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-4"></a>  <span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-5"></a>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-6"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">update the hosts file</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-7"></a>        <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">src=./hosts.j2 dest=/etc/hosts</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-8"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">update the rsyslog config</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-9"></a>        <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">src=./mesos.conf.j2 dest=/etc/rsyslog.d/mesos.conf</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-10"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">restart rsyslog</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-11"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service rsyslog restart</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-12"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install the mesosphere yum repo</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-13"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rpm -Uvh http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-14"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install zookeeper repo</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-15"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rpm -Uvh http://archive.cloudera.com/cdh4/one-click-install/redhat/6/x86_64/cloudera-cdh-4-0.x86_64.rpm</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-16"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install zookeeper</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-17"></a>        <span class="l-Scalar-Plain">yum</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pkg=zookeeper,zookeeper-server state=latest</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-18"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">configure zookeeper ID</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-19"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sudo -u zookeeper zookeeper-server-initialize --myid=1</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-20"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install the mesos, marathon, chronos, docker packages</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-21"></a>        <span class="l-Scalar-Plain">yum</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pkg=device-mapper-event-libs,mesos,marathon,chronos,docker state=latest</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-22"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">configure containerizers</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-23"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">echo &#39;docker,mesos&#39; | sudo tee /etc/mesos-slave/containerizers</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-24"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start up zookeeper</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-25"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=zookeeper-server state=started enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-26"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start up the mesos-master</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-27"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=mesos-master state=started enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-28"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">make sure mesos-slave is running</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-29"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=mesos-slave state=started enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-30"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start marathon</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-31"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=marathon state=started enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-32"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start chronos</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-33"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=chronos state=started enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-34"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start docker</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-35"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=docker state=started enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-36"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install go and dns tools</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-37"></a>        <span class="l-Scalar-Plain">yum</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pkg=golang,git,bind-utils state=latest</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-38"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">build mesos-dns</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-39"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sudo -u vagrant sh /vagrant/installdns.sh</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-40"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install outyet</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-41"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sudo docker load --input=/vagrant/outyet.tar.gz</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-42"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start marathon services</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-43"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cd /vagrant/marathon &amp;&amp; sh post.sh</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-44"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install ruby</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-45"></a>        <span class="l-Scalar-Plain">yum</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pkg=ruby state=latest</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-46"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sync chronos jobs</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-47"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ruby /vagrant/chronos-sync.rb -u http://192.168.33.10:4400/ -p /vagrant/chronos</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-48"></a><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">hosts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nodes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-49"></a>  <span class="l-Scalar-Plain">remote_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">vagrant</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-50"></a>  <span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-51"></a>  <span class="l-Scalar-Plain">tasks</span><span class="p-Indicator">:</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-52"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">update the hosts file</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-53"></a>        <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">src=./hosts.j2 dest=/etc/hosts</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-54"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install the mesosphere yum repo</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-55"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rpm -Uvh http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-1.noarch.rpm</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-56"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install the mesos and docker packages</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-57"></a>        <span class="l-Scalar-Plain">yum</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pkg=device-mapper-event-libs,mesos,docker state=latest</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-58"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">configure containerizers</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-59"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">echo &#39;docker,mesos&#39; | sudo tee /etc/mesos-slave/containerizers</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-60"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">set the zookeeper master</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-61"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sed -i -e &#39;s/localhost/192.168.33.10/g&#39; /etc/mesos/zk</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-62"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">stop the mesos slave but make it start on book</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-63"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=mesos-slave state=stopped enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-64"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">disable the mesos-master by default</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-65"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=mesos-master state=stopped enabled=no</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-66"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">kill the slave state</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-67"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">rm -rf /tmp/mesos*</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-68"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">start docker</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-69"></a>        <span class="l-Scalar-Plain">service</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">name=docker state=started enabled=yes</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-70"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">install outyet</span>
<a name="code--ex20--playbook_full.yml-jinja-idio.html-71"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sudo docker load --input=/vagrant/outyet.tar.gz</span>
</pre></div><p>And your final <tt class="docutils literal">Vagrantfile</tt> is this:</p>
<div class="highlight"><pre><a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-1"></a><span class="c1"># -*- mode: ruby -*-</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-2"></a><span class="c1"># vi: set ft=ruby :</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-3"></a>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-4"></a><span class="no">ANSIBLE_GROUPS</span> <span class="o">=</span> <span class="p">{</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-5"></a>              <span class="s2">&quot;master&quot;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;node1&quot;</span><span class="o">]</span><span class="p">,</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-6"></a>              <span class="s2">&quot;nodes&quot;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;node2&quot;</span><span class="o">]</span><span class="p">,</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-7"></a>              <span class="s2">&quot;all_groups:children&quot;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="o">]</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-8"></a>            <span class="p">}</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-9"></a>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-10"></a>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-11"></a><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-12"></a>    <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;chef/centos-7.0&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-13"></a>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-14"></a>    <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&quot;node1&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">node1</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-15"></a>        <span class="n">node1</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.33.10&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-16"></a>        <span class="n">node1</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-17"></a>        <span class="c1">#node1.vm.box = &quot;mesos-master&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-18"></a>        <span class="n">node1</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;ansible&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">ansible</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-19"></a>            <span class="n">ansible</span><span class="o">.</span><span class="n">playbook</span> <span class="o">=</span> <span class="s2">&quot;playbook.yml&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-20"></a>            <span class="n">ansible</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="no">ANSIBLE_GROUPS</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-21"></a>        <span class="k">end</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-22"></a>    <span class="k">end</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-23"></a>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-24"></a>    <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&quot;node2&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">node2</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-25"></a>        <span class="n">node2</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.33.11&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-26"></a>        <span class="n">node2</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;node2&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-27"></a>        <span class="n">node2</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;ansible&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">ansible</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-28"></a>            <span class="n">ansible</span><span class="o">.</span><span class="n">playbook</span> <span class="o">=</span> <span class="s2">&quot;playbook.yml&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-29"></a>            <span class="n">ansible</span><span class="o">.</span><span class="n">groups</span> <span class="o">=</span> <span class="no">ANSIBLE_GROUPS</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-30"></a>        <span class="k">end</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-31"></a>    <span class="k">end</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-32"></a>    <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&quot;node3&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">node3</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-33"></a>        <span class="n">node3</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.33.12&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-34"></a>        <span class="n">node3</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;node3&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-35"></a>        <span class="n">node3</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;mesos-slave&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-36"></a>        <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="s2">&quot;sudo cp /vagrant/hosts.j2 /etc/hosts&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-37"></a>    <span class="k">end</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-38"></a>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-39"></a>    <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">define</span> <span class="s2">&quot;node4&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">node4</span><span class="o">|</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-40"></a>        <span class="n">node4</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.33.13&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-41"></a>        <span class="n">node4</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;node4&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-42"></a>        <span class="n">node4</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;mesos-slave&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-43"></a>        <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">inline</span><span class="p">:</span> <span class="s2">&quot;sudo cp /vagrant/hosts.j2 /etc/hosts&quot;</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-44"></a>    <span class="k">end</span>
<a name="code--ex20--Vagrantfile_full.rb-jinja-idio.html-45"></a><span class="k">end</span>
</pre></div><p>With these two files, and the <tt class="docutils literal">marathon</tt> and <tt class="docutils literal">chronos</tt> configuration directories, you are now able to build a full Mesos cluster repeatably and you should be able to
move this similar build to your own cluster.</p>
</div>
<div class="section" id="further-study">
<h1>Further Study</h1>
<p>This is the end of the first course.  More to come as we receive feedback on it and will have some further study then.</p>
</div>
                <!-- RST ENDS -->

                <h2 id="comments"></h2>
                <p></p>
                <div id="disqus_thread"></div>

                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


            </div>

        </div>

        <script type="text/javascript">
!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
    analytics.load("jb9aik674n");
    analytics.page()
}}();
        </script>
    </div>
    <footer class=" ">
        <div class="container">
            <p align="center"><span class="text-muted"><a href="/support/" target="_blank">Support and feedback</a> | <a href="https://mesosphere.com/terms/" target="_blank">Terms of service</a> | <a href="https://mesosphere.com/privacy/" target="_blank">Privacy Policy</a> </span>
            <p align="center"><span class="text-muted">&copy; 2015 Mesosphere, Inc. All Rights Reserved.</span>
            <!-- div class="row">
                <div class="col-sm-3">
                    <ul class="list-unstyled">
                        <li><a href="http://mesosphere.com/team/">Team</a>
                        <li><a href="http://mesosphere.com/news-events/">News &amp; Events</a></li>
                        <li><a href="http://mesosphere.com/jobs/">Careers</a>
                    </ul>
                </div>
                <div class="col-sm-3">
                    <ul class="list-unstyled">
                        <li><a href="http://mesosphere.com/resources/case-studies/">Case Studies</a>
                        <li><a href="http://mesosphere.com/resources/research/">Research</a>
                    </ul>
                </div>
                <div class="col-sm-3">
                    <ul class="list-unstyled">
                        <li><a href="https://twitter.com/mesosphere">@mesosphere</a>
                        <li><span class="text-muted">&copy; 2015 Mesosphere, Inc.</span>
                    </ul>
                </div>
            </div -->
        </div>
    </footer>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/1.3.2/ZeroClipboard.min.js"></script>

    </body>

    </html>
